/*
Built using Kango - Cross-browser extension framework
http://kangoextensions.com/
*/
/*
Built using Kango - Cross-browser extension framework.
http://kangoextensions.com/
*/
var kango={};kango.oop={extend:function(base,props){var F=function(){};F.prototype=base.prototype;var result=new F();result.superclass=base;this.mixin(result,props);return result;},mixin:function(base,props){for(var k in props){if(props.hasOwnProperty(k)){base[k]=props[k];}}},createProxy:function(baseObject){var F=function(){};F.prototype=baseObject;var result=new F();result.baseObject=baseObject;return result;},decorate:function(obj,memberName,decorator){var original=obj[memberName];obj[memberName]=function(){return decorator.call(this,original,arguments);};}};kango.array={filter:function(array,regexp){var len=array.length;var res=new Array();for(var i=0;i<len;i++){if(i in array){var val=array[i];if(regexp.test(val)){res.push(val);}}}
return res;},map:function(array,func){var len=array.length;var result=new Array(len);for(var i=0;i<len;i++){result[i]=func(array[i]);}
return result;}};kango.string={format:function(str,params){for(var i=1;i<arguments.length;i++){str=str.replace(new RegExp('\\{'+(i-1)+'}','g'),arguments[i].toString());}
return str;},isAlpha:function(ch){return(ch>='a'&&ch<='z')||(ch>='A'&&ch<='Z');},isDigit:function(ch){return(ch>='0'&&ch<='9');}};kango.date={diff:function(first,second){return Math.ceil((first.getTime()-second.getTime())/1000);}};kango.ExtensionInfo=function(){this.name='';this.version='';this.description='';this.creator='';this.homepage_url='';this.background_scripts=[];this.content_scripts=[];this.browser_button={};this.update_path_url='';};kango.NotImplementedException=function(methodName){methodName=methodName?methodName+' ':'';this.prototype=Error.prototype;this.name='KangoNotImplementedException';this.message='Method '+methodName+'is not implemented';this.toString=function(){return this.name+': '+this.message;};};kango.event={Ready:'Ready',Message:'message',Uninstall:'Uninstall'};kango.Event=function(type,obj,target){this.type=type;this.target=target||null;this.CAPTURING_PHASE=1;this.AT_TARGET=2;this.BUBBLING_PHASE=3;this.currentTarget=null;this.eventPhase=0;this.bubbles=false;this.cancelable=false;this.timeStamp=0;this.stopPropagation=function(){};this.preventDefault=function(){};if(typeof obj=='object'){kango.oop.mixin(this,obj);}};kango.EventTarget=function(){this._eventListeners={};};kango.EventTarget.prototype={_eventListeners:{},dispatchEvent:function(event){var eventType=event.type.toLowerCase();if(typeof this._eventListeners[eventType]!='undefined'){var listeners=this._eventListeners[eventType];for(var i=0;i<listeners.length;i++){listeners[i](event);}
return true;}
return false;},fireEvent:function(type,obj){return this.dispatchEvent(new kango.Event(type,obj));},addEventListener:function(type,listener){if(typeof listener.call!='undefined'&&typeof listener.apply!='undefined'){var eventType=type.toLowerCase();var listeners=this._eventListeners[eventType]=this._eventListeners[eventType]||[];for(var i=0;i<listeners.length;i++){if(listeners[i]==listener){return false;}}
listeners.push(listener);return true;}},removeEventListener:function(type,listener){var eventType=type.toLowerCase();if(typeof this._eventListeners[eventType]!='undefined'){var listeners=this._eventListeners[eventType];for(var i=0;i<listeners.length;i++){if(listeners[i]==listener){listeners.splice(i,1);return true;}}}
return false;}};kango.IConsole=function(){};kango.IConsole.prototype={log:function(str){throw new kango.NotImplementedException();}};kango.IStorage=function(){};kango.IStorage.prototype={setItem:function(name,value){throw new kango.NotImplementedException();},getItem:function(name){throw new kango.NotImplementedException();},removeItem:function(name){throw new kango.NotImplementedException();},getKeys:function(){throw new kango.NotImplementedException();},clear:function(){throw new kango.NotImplementedException();}};kango.IOBase=function(){};kango.IOBase.prototype={getExtensionFileUrl:function(url){throw new kango.NotImplementedException();},isLocalUrl:function(url){return(url.indexOf(kango.SCHEME)==0||(url.indexOf('http://')==-1&&url.indexOf('https://')==-1));},getFileUrl:function(url){if(this.isLocalUrl(url)){url=this.getExtensionFileUrl(url.replace(kango.SCHEME,''));}
return url;},getExtensionFileContents:function(filename){var req=new XMLHttpRequest();req.open('GET',this.getExtensionFileUrl(filename),false);if(typeof req.overrideMimeType!='undefined'){req.overrideMimeType('text/plain');}
try{req.send(null);return req.responseText;}
catch(e){return null;}}};kango.LangBase=function(){};kango.LangBase.prototype={getGlobalContext:function(){return((function(){return this;}).call(null));},invoke:function(context,methodName,params){var arr=methodName.split('.');var parent=context;var funcName=arr.pop();for(var i=0;i<arr.length;i++){parent=parent[arr[i]];}
return parent[funcName].apply(parent,params);},evalInSandbox:function(win,api,text){throw new kango.NotImplementedException();},bind:function(func,context){return function(){func.apply(context,arguments);};},clone:function(obj){return JSON.parse(JSON.stringify(obj));},isString:function(obj){return(typeof obj=='string'||obj instanceof String);},isObject:function(obj){return(Object.prototype.toString.call(obj)=='[object Object]'||typeof obj=='object');},isArray:function(obj){return(obj instanceof Array||Object.prototype.toString.call(obj)=='[object Array]');},isFunction:function(obj){return(typeof obj=='function');}};(function(){kango.oop.mixin(kango,kango.EventTarget.prototype);kango.oop.mixin(kango,new kango.EventTarget());kango.oop.mixin(kango,{_configFileName:'extension_info.json',_extensionInfo:null,_messageRouter:null,_modules:[],_loadExtensionInfo:function(){if(this._extensionInfo==null){this._extensionInfo=JSON.parse(kango.io.getExtensionFileContents(this._configFileName));}},_initMessaging:function(){var self=this;this._messageRouter=new kango.MessageRouter();this._messageRouter.onmessage=function(event){self.fireEvent(self.event.Message,event);};this.dispatchMessage=function(name,data){this._messageRouter.dispatchMessage(name,data);};},_initModules:function(){for(var i=0;i<this._modules.length;i++){(new this._modules[i]()).init(kango);}},_init:function(){this._loadExtensionInfo();this._initMessaging();this._initModules();return this.fireEvent(this.event.Ready);},registerModule:function(classObj){this._modules.push(classObj);},getExtensionInfo:function(){if(this._extensionInfo==null){this._loadExtensionInfo();}
return kango.lang.clone(this._extensionInfo);},getContext:function(){var background=kango.backgroundScript.getContext();return background?background:kango.lang.getGlobalContext();},isDebug:function(){var info=this.getExtensionInfo();return(typeof info.debug!='undefined'&&info.debug);},SCHEME:'kango-extension://'});})();