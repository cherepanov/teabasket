/*
Built using Kango - Cross-browser extension framework
http://kangoextensions.com/
*/
/*
Built using TeaBasket_kango - Cross-browser extension framework.
http://kangoextensions.com/
*/
TeaBasket_kango.PrefStorage=function(){this._preferenceBranch=Components.classes['@mozilla.org/preferences-service;1'].getService(Components.interfaces.nsIPrefService).getBranch(this.PREFERENCE_BRANCH_NAME);};TeaBasket_kango.PrefStorage.prototype={_preferenceBranch:null,PREFERENCE_BRANCH_NAME:'extensions.'+'TeaBasket_kango'+'.storage.',setItem:function(name,value){return this._preferenceBranch.setCharPref(name,JSON.stringify(value));},getItem:function(name){var type=this._preferenceBranch.getPrefType(name);var val=null;if(type==this._preferenceBranch.PREF_STRING){val=this._preferenceBranch.getCharPref(name);}
else if(type==this._preferenceBranch.PREF_INT){val=this._preferenceBranch.getIntPref(name);}
else if(type==this._preferenceBranch.PREF_BOOL){val=this._preferenceBranch.getBoolPref(name);}
if(typeof val!='undefined'&&val!=null){return JSON.parse(val);}
else{return null;}},removeItem:function(name){try{return this._preferenceBranch.clearUserPref(name);}
catch(e){return false;}},getKeys:function(){var count={};return this._preferenceBranch.getChildList('',count);},clear:function(){return this._preferenceBranch.deleteBranch('');}};TeaBasket_kango.Storage=function(){var url='http://'+this._getDomainFromId(TeaBasket_kango.getExtensionInfo().id)+'.kangoextensions.com';this._storage=this._getLocalStorageForUrl(url);this._migrateFrom095();};TeaBasket_kango.Storage.prototype=TeaBasket_kango.oop.extend(TeaBasket_kango.IStorage,{_storage:null,_migrateFrom095:function(){var storage095=this._getLocalStorageForUrl('http://'+'TeaBasket_kango'.replace('_','-')+'.kangoextensions.com');var len=storage095.length;for(var i=0;i<len;i++){var key=storage095.key(i);this._storage.setItem(key,storage095.getItem(key));}
if(len>0){storage095.clear();}},_getDomainFromId:function(str){var result='';for(var i=0;i<str.length;i++){if(TeaBasket_kango.string.isAlpha(str[i])||TeaBasket_kango.string.isDigit(str[i])||str[i]=='-'){result+=str[i];}}
return result;},_getLocalStorageForUrl:function(url){var ioService=Components.classes['@mozilla.org/network/io-service;1'].getService(Components.interfaces.nsIIOService);var scriptSecManager=Components.classes['@mozilla.org/scriptsecuritymanager;1'].getService(Components.interfaces.nsIScriptSecurityManager);var domStorageManager=Components.classes['@mozilla.org/dom/storagemanager;1'].getService(Components.interfaces.nsIDOMStorageManager);var uri=ioService.newURI(url,null,null);var principal=scriptSecManager.getCodebasePrincipal(uri);return domStorageManager.getLocalStorageForPrincipal(principal,'');},getItem:function(name){var value=this._storage.getItem(name);if(typeof value!='undefined'){return JSON.parse(value);}
else{return null;}},setItem:function(name,value){return this._storage.setItem(name,JSON.stringify(value));},removeItem:function(name){return this._storage.removeItem(name);},clear:function(){return this._storage.clear();},getKeys:function(){var keys=[];for(var i=0;i<this._storage.length;i++){keys.push(this._storage.key(i));}
return keys;}});TeaBasket_kango.storage=new TeaBasket_kango.Storage();TeaBasket_kango.addEventListener(TeaBasket_kango.event.Uninstall,function(){window.addEventListener('beforeunload',function(){TeaBasket_kango.storage.clear();},false);});(function(){var prefStorage=new TeaBasket_kango.PrefStorage();var keys=prefStorage.getKeys();if(keys.length>0){for(var i=0;i<keys.length;i++){TeaBasket_kango.storage.setItem(keys[i],prefStorage.getItem(keys[i]));}
prefStorage.clear();}})();